<!doctype html>
<html ⚡4email data-css-strict>
    <head>
        <meta charset="utf-8" />
        <script async src="https://cdn.ampproject.org/v0.js"></script>
        <script async custom-element="amp-bind" src="https://cdn.ampproject.org/v0/amp-bind-0.1.js"></script>
        <style amp4email-boilerplate>
            body {
                visibility:hidden
            }
        </style>
        <style amp-custom>
            p {
                margin: 0;
                padding: 0;
            }

            .hide {
                display: none;
            }

            .show { }

            .logo-size {
                height: 20px;
                width: 20px;
            }

            .tile-size {
                height: 50px;
                width: 50px;
            }

            .color-correct-spot {
                color: white;
                font-weight: 600;
                border: 2px solid #459624;
                background-color: #459624;
            }

            .color-wrong-spot {
                color: white;
                font-weight: 600;
                border: 2px solid #C8A212;
                background-color: #C8A212;
            }

            .color-not-listed-letter {
                color: white;
                font-weight: 600;
                border: 2px solid #474B4D;
                background-color: #474B4D;
            }

            .color-empty-spot {
                color: white;
                font-weight: 600;
                border: 2px solid #b2b2b2;
                background-color: white;
            }
        </style>
    </head>

    <body>
        <amp-state id="words">
            <script type="application/json">
                [
                    "stack",
                    "cache",
                    "debug",
                    "cloud",
                    "token",
                    "proxy",
                    "query",
                    "bytes",
                    "login",
                    "admin",
                    "patch",
                    "stack",
                    "mouse",
                    "board",
                    "virus",
                    "logic",
                    "cyber",
                    "shell"
                ]
            </script>

        </amp-state>
        <amp-state id="state">
            <script type="application/json">
                {
                    "gameState": "",
                    "word": "",
                    "guess": "",
                    "openWordList": false
                }
            </script>
        </amp-state>
        <amp-state id="guesses">
            <script type="application/json">
                []
            </script>
        </amp-state>
        <amp-state id="guessesColors">
            <script type="application/json">
                []
            </script>
        </amp-state>

        <!-- LOGGING - FOR DEVELOPMENT ONLY  -->

        <!-- <p [text]="'word: ' + (state.word || '')">word:</p> -->
        <!-- <p [text]="'gameState: ' + (state.gameState || '')">gameState:</p> -->

        <!-- TESTING NOTE -->

        <!-- stack -> aaaaa -->
        <!-- grey-grey-green-grey-grey -->

        <!-- stack -> aaaab -->
        <!-- grey-grey-green-grey-grey -->

        <!-- stack -> bbbaa -->
        <!-- grey-grey-grey-grey-yellow -->

        <!-- stack -> babaa -->
        <!-- grey-grey-grey-grey-yellow -->

        <!-- stack -> aabbb -->
        <!-- grey-yellow-grey-grey-grey -->

        <!-- still -> lllbt -->
        <!-- grey-yellow-yellow-grey-yellow -->

        <!-- still -> llllt -->
        <!-- grey-grey-yellow-green-yellow -->

        <!-- still -> ltill -->
        <!-- grey-green-green-green-green -->

        <!-- still -> ltila -->
        <!-- yellow-green-green-green-grey -->

        <!-- HEADER -->
        <table [hidden]="!state.word" style="margin: auto; padding-top: 16px;">
            <tr align="center">
                <td class="color-correct-spot logo-size">W</td>
                <td class="color-wrong-spot logo-size">O</td>
                <td class="color-not-listed-letter logo-size">R</td>
                <td class="color-correct-spot logo-size">D</td>
                <td class="color-correct-spot logo-size">L</td>
                <td class="color-wrong-spot logo-size">E</td>
            </tr>
            <tr>
                <td colspan="6">
                    <p style="font-weight: 400; font-size: 12px; text-align: center;">
                        on email
                    </p>
                </td>
            </tr>
        </table>

        <!-- GUESSES -->
        <table style="margin: auto; padding-top: 16px;">
            <tr align="center">
                <td [class]="guessesColors[0][0] || 'color-empty-spot tile-size'" class="color-empty-spot tile-size" [text]="guesses[0][0] || '&nbsp;'" style="text-transform: uppercase;">&nbsp;</td>
                <td [class]="guessesColors[0][1] || 'color-empty-spot tile-size'" class="color-empty-spot tile-size" [text]="guesses[0][1] || '&nbsp;'" style="text-transform: uppercase">&nbsp;</td>
                <td [class]="guessesColors[0][2] || 'color-empty-spot tile-size'" class="color-empty-spot tile-size" [text]="guesses[0][2] || '&nbsp;'" style="text-transform: uppercase">&nbsp;</td>
                <td [class]="guessesColors[0][3] || 'color-empty-spot tile-size'" class="color-empty-spot tile-size" [text]="guesses[0][3] || '&nbsp;'" style="text-transform: uppercase">&nbsp;</td>
                <td [class]="guessesColors[0][4] || 'color-empty-spot tile-size'" class="color-empty-spot tile-size" [text]="guesses[0][4] || '&nbsp;'" style="text-transform: uppercase">&nbsp;</td>
            </tr>
            <tr align="center">
                <td [class]="guessesColors[1][0] || 'color-empty-spot tile-size'" class="color-empty-spot tile-size" [text]="guesses[1][0] || '&nbsp;'" style="text-transform: uppercase;">&nbsp;</td>
                <td [class]="guessesColors[1][1] || 'color-empty-spot tile-size'" class="color-empty-spot tile-size" [text]="guesses[1][1] || '&nbsp;'" style="text-transform: uppercase">&nbsp;</td>
                <td [class]="guessesColors[1][2] || 'color-empty-spot tile-size'" class="color-empty-spot tile-size" [text]="guesses[1][2] || '&nbsp;'" style="text-transform: uppercase">&nbsp;</td>
                <td [class]="guessesColors[1][3] || 'color-empty-spot tile-size'" class="color-empty-spot tile-size" [text]="guesses[1][3] || '&nbsp;'" style="text-transform: uppercase">&nbsp;</td>
                <td [class]="guessesColors[1][4] || 'color-empty-spot tile-size'" class="color-empty-spot tile-size" [text]="guesses[1][4] || '&nbsp;'" style="text-transform: uppercase">&nbsp;</td>
            </tr>
            <tr align="center">
                <td [class]="guessesColors[2][0] || 'color-empty-spot tile-size'" class="color-empty-spot tile-size" [text]="guesses[2][0] || '&nbsp;'" style="text-transform: uppercase;">&nbsp;</td>
                <td [class]="guessesColors[2][1] || 'color-empty-spot tile-size'" class="color-empty-spot tile-size" [text]="guesses[2][1] || '&nbsp;'" style="text-transform: uppercase">&nbsp;</td>
                <td [class]="guessesColors[2][2] || 'color-empty-spot tile-size'" class="color-empty-spot tile-size" [text]="guesses[2][2] || '&nbsp;'" style="text-transform: uppercase">&nbsp;</td>
                <td [class]="guessesColors[2][3] || 'color-empty-spot tile-size'" class="color-empty-spot tile-size" [text]="guesses[2][3] || '&nbsp;'" style="text-transform: uppercase">&nbsp;</td>
                <td [class]="guessesColors[2][4] || 'color-empty-spot tile-size'" class="color-empty-spot tile-size" [text]="guesses[2][4] || '&nbsp;'" style="text-transform: uppercase">&nbsp;</td>
            </tr>
            <tr align="center">
                <td [class]="guessesColors[3][0] || 'color-empty-spot tile-size'" class="color-empty-spot tile-size" [text]="guesses[3][0] || '&nbsp;'" style="text-transform: uppercase;">&nbsp;</td>
                <td [class]="guessesColors[3][1] || 'color-empty-spot tile-size'" class="color-empty-spot tile-size" [text]="guesses[3][1] || '&nbsp;'" style="text-transform: uppercase">&nbsp;</td>
                <td [class]="guessesColors[3][2] || 'color-empty-spot tile-size'" class="color-empty-spot tile-size" [text]="guesses[3][2] || '&nbsp;'" style="text-transform: uppercase">&nbsp;</td>
                <td [class]="guessesColors[3][3] || 'color-empty-spot tile-size'" class="color-empty-spot tile-size" [text]="guesses[3][3] || '&nbsp;'" style="text-transform: uppercase">&nbsp;</td>
                <td [class]="guessesColors[3][4] || 'color-empty-spot tile-size'" class="color-empty-spot tile-size" [text]="guesses[3][4] || '&nbsp;'" style="text-transform: uppercase">&nbsp;</td>
            </tr>
            <tr align="center">
                <td [class]="guessesColors[4][0] || 'color-empty-spot tile-size'" class="color-empty-spot tile-size" [text]="guesses[4][0] || '&nbsp;'" style="text-transform: uppercase;">&nbsp;</td>
                <td [class]="guessesColors[4][1] || 'color-empty-spot tile-size'" class="color-empty-spot tile-size" [text]="guesses[4][1] || '&nbsp;'" style="text-transform: uppercase">&nbsp;</td>
                <td [class]="guessesColors[4][2] || 'color-empty-spot tile-size'" class="color-empty-spot tile-size" [text]="guesses[4][2] || '&nbsp;'" style="text-transform: uppercase">&nbsp;</td>
                <td [class]="guessesColors[4][3] || 'color-empty-spot tile-size'" class="color-empty-spot tile-size" [text]="guesses[4][3] || '&nbsp;'" style="text-transform: uppercase">&nbsp;</td>
                <td [class]="guessesColors[4][4] || 'color-empty-spot tile-size'" class="color-empty-spot tile-size" [text]="guesses[4][4] || '&nbsp;'" style="text-transform: uppercase">&nbsp;</td>
            </tr>
            <tr align="center">
                <td [class]="guessesColors[5][0] || 'color-empty-spot tile-size'" class="color-empty-spot tile-size" [text]="guesses[5][0] || '&nbsp;'" style="text-transform: uppercase;">&nbsp;</td>
                <td [class]="guessesColors[5][1] || 'color-empty-spot tile-size'" class="color-empty-spot tile-size" [text]="guesses[5][1] || '&nbsp;'" style="text-transform: uppercase">&nbsp;</td>
                <td [class]="guessesColors[5][2] || 'color-empty-spot tile-size'" class="color-empty-spot tile-size" [text]="guesses[5][2] || '&nbsp;'" style="text-transform: uppercase">&nbsp;</td>
                <td [class]="guessesColors[5][3] || 'color-empty-spot tile-size'" class="color-empty-spot tile-size" [text]="guesses[5][3] || '&nbsp;'" style="text-transform: uppercase">&nbsp;</td>
                <td [class]="guessesColors[5][4] || 'color-empty-spot tile-size'" class="color-empty-spot tile-size" [text]="guesses[5][4] || '&nbsp;'" style="text-transform: uppercase">&nbsp;</td>
            </tr>
        </table>

        <!-- ACTIONS -->
        <table cellpadding="8px" style="margin: auto; padding-top: 16px;">
            <tr [class]="state.word ? 'hide' : 'show'" class="show" align="center">
                <td>
                    <button
                            on="tap:AMP.setState({
                                    state: {
                                        word: words[floor(random() * words.length)]
                                    }
                               })"
                    >
                        Start Wordle
                    </button>
                </td>
            </tr>
            <tr [class]="state.gameState == 'WIN' ? 'show' : 'hide'" class="hide" align="center">
                <td>
                    <p style="background-color: #459624; color: white; padding: 8px; font-size: 20px; font-weight: 600;">
                        You Win!!!
                    </p>
                </td>
            </tr>
            <tr [class]="['WIN', 'LOSE'].includes(state.gameState) ? 'show' : 'hide'" class="hide" align="center">
                <td>
                    <button
                            on="tap:AMP.setState({
                                    state: {
                                        word: words[floor(random() * words.length)],
                                        gameState: '',
                                    },
                                    guesses: [],
                                    guessesColors: []
                                })"
                    >
                        Start Over?
                    </button>
                </td>
            </tr>
            <tr [class]="state.word && !state.gameState  ? 'show' : 'hide'" class="hide">
                <td>
                    <input
                            [value]="state.guess || ''"
                            type="text"
                            name="guess"
                            on="input-throttled:AMP.setState({
                                    state: {
                                        guess: event.value
                                    }
                                })"
                    >
                    <button
                            [disabled]="state.guess.length != 5  || !words.some(word => word.toLowerCase() == state.guess.toLowerCase())"
                            disabled
                            on="tap:AMP.setState({
                                    state: {
                                        guess: '',
                                        gameState: state.guess.toLowerCase() == state.word.toLowerCase()
                                                    ? 'WIN'
                                                    : guesses.length >= 5
                                                        ? 'LOSE'
                                                        : '',
                                    },
                                    guesses: guesses.concat([state.guess]),
                                    guessesColors: guessesColors.concat([
                                        state.guess.split('').map((guessChar, guessCharIndex) => !guessChar
                                            ? 'color-empty-spot tile-size'
                                            : guessChar.toLowerCase() == state.word[guessCharIndex].toLowerCase()
                                                ? 'color-correct-spot tile-size'
                                                : state.word.toLowerCase().indexOf(guessChar.toLowerCase()) >= 0
                                                  && (
                                                    state.word.toLowerCase().split('').filter(v => v == guessChar.toLowerCase()).length
                                                    - state.word.toLowerCase().slice(0, guessCharIndex+1).split('').filter((v, idx) => v == state.guess[idx].toLowerCase()).length
                                                  )
                                                     >= state.guess.toLowerCase().slice(guessCharIndex).split('').filter(v => v == guessChar.toLowerCase()).length
                                                    ? 'color-wrong-spot tile-size'
                                                    : 'color-not-listed-letter tile-size'
                                        )
                                    ]),
                                });"
                    >
                        Answer!
                    </button>
                    <p [text]="state.guess == '' ? '&nbsp;' : state.guess.length <= 0 ? 'required field' : state.guess.length != 5 ? 'must input 5 character' : !words.some(word => word.toLowerCase() == state.guess.toLowerCase()) ? 'not in word list!' : '&nbsp;'" style="font-size: 12px; padding-top: 2px; color: red;">&nbsp;</p>
                </td>
            </tr>
        </table>

        <!-- FOOTER -->
        <table style="margin: auto; padding-top: 24px; padding-bottom: 24px;">
            <tr align="center">
                <td>
                    <p style="font-weight: 400; font-size: 12px; text-align: center;">
                        made with ❤️ by oxwazz
                        <br/>
                        <a href="https://github.com/oxwazz/wordle_on_email" style="color: #0079da; text-decoration: none;">
                            source code
                        </a>
                    </p>
                </td>
            </tr>
        </table>

        <!-- HELPER -->
        <table style="margin: auto; padding-bottom: 16px;">
            <tr>
                <td>
                    <button on="tap:AMP.setState({ state: { openWordList: !state.openWordList } })" [text]="state.openWordList ? 'Hide Word List' : 'Show Word List'" style="background-color: transparent; border: none; color: #0079da; text-decoration: underline;">
                        Show Word List
                    </button>
                </td>
            </tr>
            <tr>
                <td>
                    <ul [hidden]="!state.openWordList" hidden style="list-style: none; background-color: #dfdfdf; padding: 16px; border-radius: 8px; font-size: 14px;">
                        <li [text]="'- ' + words[0]">&nbsp;</li>
                        <li [text]="'- ' + words[1]">&nbsp;</li>
                        <li [text]="'- ' + words[2]">&nbsp;</li>
                        <li [text]="'- ' + words[3]">&nbsp;</li>
                        <li [text]="'- ' + words[4]">&nbsp;</li>
                        <li [text]="'- ' + words[5]">&nbsp;</li>
                        <li [text]="'- ' + words[6]">&nbsp;</li>
                        <li [text]="'- ' + words[7]">&nbsp;</li>
                        <li [text]="'- ' + words[8]">&nbsp;</li>
                        <li [text]="'- ' + words[9]">&nbsp;</li>
                        <li [text]="'- ' + words[10]">&nbsp;</li>
                        <li [text]="'- ' + words[11]">&nbsp;</li>
                        <li [text]="'- ' + words[12]">&nbsp;</li>
                        <li [text]="'- ' + words[13]">&nbsp;</li>
                        <li [text]="'- ' + words[14]">&nbsp;</li>
                        <li [text]="'- ' + words[15]">&nbsp;</li>
                        <li [text]="'- ' + words[16]">&nbsp;</li>
                    </ul>
                </td>
            </tr>
        </table>
    </body>
</html>